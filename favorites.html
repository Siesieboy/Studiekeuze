<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="studiekeuze_favicon.png">
<title>Mijn Favorieten</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
.line-clamp-3{
    display:-webkit-box;
    -webkit-line-clamp:3;
    line-clamp:3;
    -webkit-box-orient:vertical;
    overflow:hidden;
}
.study-image{
    width:200px;
    height:180px;
    object-fit:cover;
    border-radius:0.75rem;
    flex-shrink:0;
}
.modal-image{
    width:100%;
    height:300px;
    object-fit:cover;
    border-radius:0.75rem;
    margin-bottom:1rem;
}
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-100 to-indigo-200 p-6">

<div class="max-w-6xl mx-auto">

<!-- HEADER -->
<div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border border-indigo-100">
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
            <i data-lucide="star" class="w-10 h-10 text-indigo-600"></i>
            <div>
                <h2 class="text-3xl font-bold text-indigo-800">Mijn Favorieten</h2>
                <p id="levelAdvice" class="text-indigo-700"></p>
            </div>
        </div>
        <a href="index.html" class="px-5 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 font-semibold">
            ← Terug
        </a>
    </div>
</div>

<!-- FAVORIETEN GRID -->
<div id="favoritesGrid" class="grid grid-cols-2 gap-8"></div>

</div>

<!-- MODAL -->
<div id="studyModal"
    class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    onclick="closeModal()">

    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto"
         onclick="event.stopPropagation()">

        <div id="modalImageArea"></div>
        <div id="modalTitleArea"></div>
        <div id="modalBody" class="mt-4"></div>

        <button onclick="closeModal()"
            class="mt-6 px-4 py-2 bg-indigo-100 rounded-xl font-semibold text-indigo-700">
            Sluiten
        </button>
    </div>
</div>

<script>
/* ======================================================
   LOAD STUDIES & FAVORITES
   ====================================================== */

let studies = JSON.parse(localStorage.getItem("allStudies")) || [];

function getFavorites(){
    return JSON.parse(localStorage.getItem("favorites")) || [];
}

function isFavorite(id){
    return getFavorites().includes(id);
}

function toggleFavorite(id){
    let favs = getFavorites();
    favs.includes(id) ? favs = favs.filter(f=>f!==id) : favs.push(id);
    localStorage.setItem("favorites", JSON.stringify(favs));
    renderFavorites();
}

/* ======================================================
   RENDER FAVORITES
   ====================================================== */

function renderFavorites(){
    const favs = getFavorites();
    const favStudies = studies.filter(s=>favs.includes(s.id));
    favoritesGrid.innerHTML = "";

    let wo = favStudies.filter(s=>s.level.includes("WO")).length;
    let hbo = favStudies.filter(s=>s.level.includes("HBO")).length;
    let mbo = favStudies.filter(s=>s.level.includes("MBO")).length;

    levelAdvice.innerText =
        favStudies.length === 0 ? "" :
        wo>=hbo && wo>=mbo ? "Je voorkeur wijst vooral naar WO-opleidingen." :
        hbo>=wo && hbo>=mbo ? "HBO lijkt het beste bij jouw interesses te passen." :
        "MBO sluit goed aan bij wat jij interessant vindt.";

    if(favStudies.length === 0){
        favoritesGrid.innerHTML = `
            <div class="bg-white rounded-2xl shadow-xl p-8 border border-indigo-100 text-center">
                <p class="text-xl font-semibold text-indigo-800 mb-4">Je hebt nog geen favorieten toegevoegd.</p>
                <a href="index.html" class="inline-block px-5 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 font-semibold">
                    Zoek studies
                </a>
            </div>`;
        lucide.createIcons();
        return;
    }

    favStudies.forEach(s=>{
        const imageHtml = s.image ? `<img src="${s.image}" alt="${s.name}" class="study-image" onerror="this.style.display='none'">` : '';
        
        const cardDiv = document.createElement('div');
        cardDiv.className = "bg-white rounded-2xl shadow-xl p-6 cursor-pointer border border-indigo-100 hover:shadow-2xl transition flex gap-4 items-start";
        cardDiv.onclick = function() { openModal(s.id); };
        
        cardDiv.innerHTML = `
            ${imageHtml}
            <div class="flex-1">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="text-xl font-bold text-indigo-800">${s.name}</h3>
                    <button class="text-2xl text-yellow-400 star-btn" data-id="${s.id}">★</button>
                </div>
                <p class="text-indigo-700 font-medium">${s.university}</p>
                <p class="text-sm text-indigo-500">${s.city}</p>
                <p class="mt-3 text-gray-700 line-clamp-3">${s.description}</p>
            </div>
        `;
        
        favoritesGrid.appendChild(cardDiv);
        
        // Event listener voor de ster knop
        const starBtn = cardDiv.querySelector('.star-btn');
        starBtn.onclick = function(e) {
            e.stopPropagation();
            toggleFavorite(parseInt(this.getAttribute('data-id')));
        };
    });

    lucide.createIcons();
}

/* ======================================================
   MODAL
   ====================================================== */

function openModal(id){
    const s = studies.find(st=>st.id===id);

    const imageHtml = s.image ? `<img src="${s.image}" alt="${s.name}" class="modal-image" onerror="this.style.display='none'">` : '';

    modalImageArea.innerHTML = imageHtml;

    modalTitleArea.innerHTML = `
        <h2 class="text-3xl font-bold text-indigo-800">${s.name}</h2>
        <p class="text-indigo-600">${s.university}</p>
    `;

    const modalBtn = document.createElement('button');
    modalBtn.className = "mb-4 px-4 py-2 rounded-xl bg-yellow-100 text-yellow-700 font-semibold";
    modalBtn.textContent = "★ Verwijderen uit favorieten";
    modalBtn.onclick = function() {
        toggleFavorite(s.id);
        closeModal();
    };

    modalBody.innerHTML = `
        <p><b>Niveau:</b> ${s.level}</p>
        <p><b>Duur:</b> ${s.duration}</p>
        <p><b>Locatie:</b> ${s.address}</p>
        <p><b>Kosten:</b> ${s.costs}</p>
        <p class="mt-3">${s.description}</p>
    `;
    
    modalBody.insertBefore(modalBtn, modalBody.firstChild);

    studyModal.classList.remove("hidden");
}

function closeModal(){
    studyModal.classList.add("hidden");
}

/* ====================================================== */

renderFavorites();
lucide.createIcons();
</script>

</body>
</html>
